# 3장 가비지 컬렉터와 메모리 할당 전략

가비지 컬렉션이 처리해야 하는 문제 세 가지 

- 어떤 메모리를 회수해야 하나?
- 언제 회수해야 할까?
- 어떻게 회수해야 할까?

왜 우리는 가비지 컬렉션과 메모리 할당의 내부를 이해해야 하는가?

- 다양한 메모리 오버플로와 누수 문제를 해결해야 하는 상황
- 더 높은 동시성을 달성하는 데 GC 가 방해가 되는 상황

이러한 상황이 왔을 때 기술을 *모니터링하고 조율하여 해결할 수 있어야 하기 때문이다.*

JVM 의 다양한 런타임 영역 중 우리가 고려해야 할 영역은 정해져 있다.

- pc registers, 가상 머신 스택, 네이티브 메소드 스택
    - 스레드와 함께 생성되고 소멸한다. 자동 회수되므로 GC 의 대상이 아니다.
    - 스택 프레임에 할당되는 메모리 크기는 기본적으로 클래스가 만들어질 때 결정된다. (JIT 가 런타임에 최적화하는 경우가 있지만?)
    - 해당 영역들은 메모리 할당과 회수가 결정적이므로 어떻게 회수할 지 고민하지 않아도 된다.
    - 메소드가 끝나거나 스레드 종료 시 알아서 자연스럽게 회수된다.
- java heap, 메소드 영역
    - ***GC 의 대상 영역***
    - 같은 인터페이스라도 구현체에 따라 요구하는 메모리 크기가 다르다.
    - 하나의 메소드에서도 어떤 조건 분기를 실행하느냐에 따라 메모리 요구량이 달라진다.
    - 프로그램이 어떤 객체를 생성할지, 얼마나 많이 만들지는 **오직 런타임에만 알 수 있다.**
    - 런타임에만 알 수 있다 → 메모리 영역들의 할당과 회수가 동적으로 이루어진다.